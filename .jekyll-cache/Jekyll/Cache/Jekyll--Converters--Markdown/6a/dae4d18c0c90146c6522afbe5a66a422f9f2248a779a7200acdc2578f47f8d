I"ôO<h1 id="win10ä¸­ä½¿ç”¨dockeræ­å»ºdjangoå¼€å‘ç¯å¢ƒ">Win10ä¸­ä½¿ç”¨Dockeræ­å»ºDjangoå¼€å‘ç¯å¢ƒ</h1>

<h2 id="ä¸‹è½½é“¾æ¥">ä¸‹è½½é“¾æ¥</h2>

<p><a href="https://hub.docker.com/">Docker</a></p>

<h2 id="å®‰è£…">å®‰è£…</h2>

<p>æ— è„‘å®‰è£…</p>

<ul>
  <li>é—®é¢˜</li>
</ul>

<p>ä½¿ç”¨dockeréœ€è¦å¯ç”¨hyper-vï¼Œé»˜è®¤æƒ…å†µä¸‹å¼€å¯hyper-véœ€è¦æ‰“å¼€biosçš„è™šæ‹ŸåŠŸèƒ½</p>

<h2 id="dockerå¸¸ç”¨å‘½ä»¤">dockerå¸¸ç”¨å‘½ä»¤</h2>

<ul>
  <li>
    <p>å®¹å™¨çš„çŠ¶æ€ï¼ˆ7ç§ï¼‰</p>

    <ul>
      <li>createdï¼ˆå·²åˆ›å»ºï¼‰</li>
      <li>restartingï¼ˆé‡å¯ä¸­ï¼‰</li>
      <li>runningï¼ˆè¿è¡Œä¸­ï¼‰</li>
      <li>removingï¼ˆè¿ç§»ä¸­ï¼‰</li>
      <li>pausedï¼ˆæš‚åœï¼‰</li>
      <li>exitedï¼ˆåœæ­¢ï¼‰</li>
      <li>deadï¼ˆæ­»äº¡</li>
    </ul>
  </li>
  <li>
    <p>dockerå¸¸ç”¨å‘½ä»¤</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nt">--version</span>  <span class="c"># äº§çœ‹dockerç‰ˆæœ¬</span>
docker ps         <span class="c"># æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</span>
docker pull ubuntu  <span class="c"># è·å–é•œåƒ</span>
docker search <span class="o">[</span>httpd] <span class="c"># æŸ¥æ‰¾é•œåƒ</span>
docker rmi <span class="o">[</span>hello-world]  <span class="c"># åˆ é™¤é•œåƒ</span>
docker <span class="nb">rm</span> <span class="o">[</span>å®¹å™¨ID]  <span class="c"># åˆ é™¤å®¹å™¨</span>
docker image <span class="nb">ls</span>   <span class="c"># æ˜¾ç¤ºæ‰€æœ‰é•œåƒ</span>
docker stop <span class="o">[</span>å®¹å™¨IDæˆ–å®¹å™¨å]  <span class="c"># åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨</span>
docker <span class="nb">kill</span> <span class="o">[</span>å®¹å™¨IDæˆ–å®¹å™¨å]  <span class="c"># ç›´æ¥å…³é—­å®¹å™¨</span>
docker restart å®¹å™¨id  <span class="c"># é‡å¯å®¹å™¨</span>
docker attach å®¹å™¨ID  <span class="c"># è¿›å…¥å®¹å™¨</span>
docker run <span class="nt">-it</span> <span class="nt">-p</span> 8080:80 é•œåƒID  <span class="c"># å°†å¤–éƒ¨å®¿ä¸»æœºçš„8080ç«¯å£æ˜ å°„åˆ°dockerå†…éƒ¨80ç«¯å£ï¼Œå¤–éƒ¨ç«¯å£å¯ä»¥å¤šå¯¹ä¸€æˆ–ä¸€å¯¹ä¸€æ˜ å°„åˆ°å†…éƒ¨ç«¯å£ï¼Œä½†ä¸èƒ½ä¸€å¯¹å¤šæ˜ å°„åˆ°å†…éƒ¨ç«¯å£</span>
docker <span class="nb">exec</span> <span class="nt">-it</span> 784e12ee483d  /bin/bash  <span class="c"># è¿›å…¥å®¹å™¨</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>dockeræ‰¹é‡æ“ä½œå‘½ä»¤</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker stop <span class="si">$(</span>docker ps <span class="nt">-q</span><span class="si">)</span>  <span class="c"># åœæ­¢æ‰€æœ‰å®¹å™¨</span>
docker <span class="nb">rm</span> <span class="si">$(</span>docker ps <span class="nt">-aq</span><span class="si">)</span>   <span class="c"># åˆ é™¤æ‰€æœ‰åœæ­¢å®¹å™¨</span>
docker stop <span class="si">$(</span>docker ps <span class="nt">-q</span><span class="si">)</span> &amp; docker <span class="nb">rm</span> <span class="si">$(</span>docker ps <span class="nt">-aq</span><span class="si">)</span> <span class="c"># åˆ é™¤æ‰€æœ‰å®¹å™¨</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="æ­å»ºåŸºç¡€å¼€å‘ç¯å¢ƒ">æ­å»ºåŸºç¡€å¼€å‘ç¯å¢ƒ</h2>

<ol>
  <li>
    <p>ä½¿ç”¨ubuntuä½œä¸ºåŸºç¡€é•œåƒ</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull ubuntu:16.04  <span class="c"># æ‹‰å–ubuntuï¼š16.04é•œåƒ</span>
docker run <span class="nt">-it</span> ubuntu     <span class="c"># ä»¥äº¤äº’å¼æ–¹å¼è¿è¡Œubuntu</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>åœ¨ubuntuç³»ç»Ÿä¸­é…ç½®djangoå¼€å‘ç¯å¢ƒ(ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼Œè§3)</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get update  <span class="c"># æ›´æ–°æº</span>
apt-get <span class="nb">install </span>python3  <span class="c"># è¦åŠ 3ï¼Œä¸ç„¶å®‰è£…çš„æ˜¯python2.xç‰ˆæœ¬</span>
apt-get <span class="nb">install </span>python3-pip  <span class="c">#å®‰è£…pip</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ä»¥pythoné•œåƒä¸ºåŸºç¡€ï¼Œæ­å»ºdjangoå¼€å‘ç¯å¢ƒ</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull python:3.7  # æ‹‰å–python3.7å®˜æ–¹é•œåƒ
docker run -it python:3.7 /bin/bash  # ä»¥äº¤äº’æ˜¯æ–¹å¼è¿è¡Œè¯¥é•œåƒï¼Œå…¶å®å»ºç«‹äº†å®¹å™¨
</code></pre></div>    </div>
  </li>
  <li>
    <p>æ‰“åŒ…ä¸ºé•œåƒ</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]
OPTIONSè¯´æ˜ï¼š
   
-a :æäº¤çš„é•œåƒä½œè€…ï¼›
   
-c :ä½¿ç”¨DockerfileæŒ‡ä»¤æ¥åˆ›å»ºé•œåƒï¼›
   
-m :æäº¤æ—¶çš„è¯´æ˜æ–‡å­—ï¼›
   
-p :åœ¨commitæ—¶ï¼Œå°†å®¹å™¨æš‚åœã€‚
</code></pre></div>    </div>
  </li>
  <li>
    <p>åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…docker</p>
  </li>
  <li>
    <p>æ‹‰å–è‡ªå·±åˆ¶ä½œçš„é•œåƒ</p>
  </li>
  <li>
    <p>åˆ›å»ºå®¹å™¨å¹¶å»ºç«‹ç«¯å£æ˜ å°„</p>
  </li>
  <li>
    <p>å®‰è£…ssh-server</p>
  </li>
</ol>

<h2 id="åˆ¶ä½œå¥½é•œåƒå">åˆ¶ä½œå¥½é•œåƒå</h2>

<ol>
  <li>
    <p>æ‹‰å–é•œåƒ</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull zfzdr/django:1.2
</code></pre></div>    </div>
  </li>
  <li>
    <p>åˆ›å»ºå®¹å™¨å¹¶ç«¯å£æ˜ å°„</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-p</span> 22:22 <span class="nt">-p</span> 8000:8000 zfzdr/django:1.2
</code></pre></div>    </div>
  </li>
  <li>
    <p>åˆ›å»ºå¯†ç </p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>passwd
</code></pre></div>    </div>
  </li>
  <li>
    <p>é…ç½®pycharm</p>

    <ul>
      <li>pythonè§£é‡Šå™¨é…ç½®</li>
    </ul>

    <p><img src="/assets/img/image-20200802111732688.png" alt="image-20200802111732688" /></p>

    <ul>
      <li>è¿è¡Œç¯å¢ƒé…ç½®</li>
    </ul>
  </li>
</ol>

<p><img src="/assets/img/image-20200802111500006.png" alt="image-20200802111500006" /></p>

<h2 id="sshè¿æ¥dockerå®¹å™¨">SSHè¿æ¥dockerå®¹å™¨</h2>

<ol>
  <li>
    <p>åˆ›å»ºå®¹å™¨å¹¶ç«¯å£æ˜ å°„</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-p</span> 22:22 <span class="nt">-p</span> 8000:8000 <span class="nt">-p</span> 8080:8080 zfzdr/django:1.2
</code></pre></div>    </div>
  </li>
  <li>
    <p>å®‰è£…sshï¼Œä¿®æ”¹é…ç½®ï¼Œè®¾ç½®å¼€æœºè‡ªå¯åŠ¨</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/ssh/sshd_config  <span class="c"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</code></pre></div>    </div>

    <p><img src="/assets/img/image-20200803091513258.png" alt="image-20200803091513258" /></p>

    <ul>
      <li>é‡å¯sshæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼š</li>
    </ul>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> /etc/init.d/ssh  restart  <span class="c"># é‡å¯</span>
   
<span class="c"># å¼€æœºè‡ªåŠ¨å¯åŠ¨sshå‘½ä»¤</span>
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>ssh
   
<span class="c"># å…³é—­sshå¼€æœºè‡ªåŠ¨å¯åŠ¨å‘½ä»¤</span>
<span class="nb">sudo </span>systemctl disable ssh
   
<span class="c"># å•æ¬¡å¼€å¯ssh</span>
<span class="nb">sudo </span>systemctl start ssh
   
<span class="c"># å•æ¬¡å…³é—­ssh</span>
<span class="nb">sudo </span>systemctl stop ssh
   
<span class="c"># è®¾ç½®å¥½åé‡å¯ç³»ç»Ÿ</span>
reboot
   
<span class="c">#æŸ¥çœ‹sshæ˜¯å¦å¯åŠ¨ï¼Œçœ‹åˆ°Active: active (running)å³è¡¨ç¤ºæˆåŠŸ</span>
<span class="nb">sudo </span>systemctl status ssh
   
</code></pre></div>    </div>
  </li>
  <li>
    <p>pycharmä½¿ç”¨sshè¿æ¥æœ¬åœ°docker</p>
  </li>
</ol>

<h1 id="å®‰è£…django-mdeditorå’Œmarkdown">å®‰è£…django-mdeditorå’Œmarkdown</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install django-mdeditor  # å®‰è£…æ’ä»¶
pip install markdown
</code></pre></div></div>

<ul>
  <li>æ·»åŠ mdeditor</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    INSTALLED_APPS <span class="o">=</span> <span class="o">[</span>
        ...
        <span class="s1">'mdeditor'</span>,
    <span class="o">]</span>
</code></pre></div></div>

<h1 id="å®‰è£…nginxå’Œuwsgiå‚è€ƒ">å®‰è£…nginxå’Œuwsgi<a href="https://www.cnblogs.com/zouzou-busy/p/11625994.html">å‚è€ƒ</a></h1>

<ol>
  <li>å®‰è£…nginxè½¯ä»¶å¹¶æµ‹è¯•</li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>python-dev nginx  <span class="c"># å®‰è£…</span>
nginx <span class="nt">-v</span> <span class="c"># æŸ¥çœ‹nginxå®‰è£…ç‰ˆæœ¬</span>
</code></pre></div></div>

<p>Nginxçš„é»˜è®¤ç«¯å£ä¸º80ï¼Œå¾ˆå®¹æ˜“è¢«å…¶ä»–æœåŠ¡å ç”¨ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹æˆå…¶ä»–ç«¯å£ã€‚æ‰“å¼€æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/nginx/nginx.conf 
</code></pre></div></div>

<p>å¦‚æœèƒ½æ‰¾åˆ°ç›‘å¬çš„ç«¯å£ï¼Œç›´æ¥ä¿®æ”¹ ã€‚æ‰¾ä¸åˆ°çš„ä¹Ÿæ²¡å…³ç³» ï¼Œæ‰¾åˆ°å¦‚ä¸‹é…ç½® ï¼Œè¯´æ˜æ˜¯å¼•ç”¨äº†å…¶ä»–ç›®å½•çš„æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
</code></pre></div></div>

<p>æ‰“å¼€ /etc/nginx/sites-enabled/ ï¼Œæ‰¾åˆ°å¹¶ç¼–è¾‘ default ï¼Œå°†80ä¿®æ”¹æˆ8080</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Default server configuration
#
server {
    listen 8088 default_server;
    listen [::]:8088 default_server;

    ...........
</code></pre></div></div>

<p>Nginxå¯åŠ¨å‘½ä»¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service nginx start

service nginx restart

service nginx stop

</code></pre></div></div>

<p><img src="/assets/img/image-20200805110106915.png" alt="image-20200805110106915" /></p>

<ol>
  <li>
    <p>å®‰è£…usgi</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo pip install uwsgi --upgrade
</code></pre></div>    </div>
  </li>
  <li>
    <p>æµ‹è¯•uwsgiè¿è¡ŒçŠ¶æ€</p>

    <ul>
      <li>æ–°å»ºæ–‡ä»¶test.py</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">start_response</span><span class="p">(</span><span class="s">'200 OK'</span><span class="p">,</span> <span class="p">[(</span><span class="s">'Content-Type'</span><span class="p">,</span><span class="s">'text/html'</span><span class="p">)])</span>
    <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s">"Hello World"</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>
    <p>ä½¿ç”¨uwsgiè¿è¡Œè¯¥æ–‡ä»¶</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uwsgi --http :8080 --wsgi-file test.py  # ç«¯å£å¯ä»¥æ”¹å˜
</code></pre></div>    </div>
  </li>
</ul>

<p><img src="/assets/img/image-20200805103645716.png" alt="image-20200805103645716" /></p>

<p>æ­¤è¯­å¥çš„æ„æ€æ˜¯ï¼Œä½¿ç”¨uwsgiè¿è¡Œtest.pyæ–‡ä»¶ï¼Œ é‡‡ç”¨httpæ¨¡å¼ï¼Œ ç«¯å£8000</p>

<ol>
  <li>uwsgiè¿è¡Œé¡¹ç›®</li>
</ol>

<p>ç¡®ä¿å½“å‰çš„è·¯å¾„ä¸ºé¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œä¹Ÿå°±æ˜¯å’Œmanage.pyæ–‡ä»¶åŒçº§ï¼Œæ³¨æ„â€“httpåé¢æœ‰ç©ºæ ¼</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uwsgi <span class="nt">--http</span> :8080 <span class="nt">---module</span> myblog.wsgi
</code></pre></div></div>

<ul>
  <li>â€“http  æŒ‡æ˜æ˜¯httpåè®®</li>
  <li>:9001 æŒ‡å®šç«¯å£å·</li>
  <li>â€“module Apitest.wsgi åŠ è½½æŒ‡å®šçš„wsgiæ¨¡å—ï¼Œæ ¹æ®è‡ªå·±çš„é¡¹ç›®åç§°è‡ªå·±æŒ‡å®š</li>
</ul>

<p>è®¿é—®æˆ‘ä»¬çš„djangoè‡ªå¸¦çš„åå°ï¼Œé™æ€æ–‡ä»¶ä¸åŠ è½½</p>

<p><img src="/assets/img/image-20200805133326448.png" alt="image-20200805133326448" /></p>

<p>è¡¥å……ï¼šå¤§å®¶éƒ½çŸ¥é“pycharmä¼šè‡ªåŠ¨æ£€æµ‹djangoé¡¹ç›®ï¼Œå¦‚æœä»£ç æœ‰å˜åŠ¨ï¼Œä¼šè‡ªåŠ¨é‡å¯ï¼Œuswgiä¹Ÿå¯ä»¥ï¼ŒåŠ ä¸Šä¸€ä¸ªå‚æ•°å°±å¯ä»¥äº†</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uwsgi <span class="nt">--http</span> :8080 <span class="nt">--module</span> myblog.wsgi <span class="nt">--py-autoreload</span><span class="o">=</span>1
</code></pre></div></div>

<p>å¤šæ¬¡å¯åŠ¨ä¼šé‡åˆ°ç«¯å£å ç”¨é—®é¢˜ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsof -i :8080  #äº§çœ‹8080ç«¯å£å ç”¨æƒ…å†µ
kill -9 pid   # ä½¿ç”¨ kill å‘½ä»¤å³å¯æ€æ‰è¯¥è¿›ç¨‹
</code></pre></div></div>

<ol>
  <li>é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨uwsgi</li>
</ol>

<p>åœ¨æ ¹ç›®å½• /home/zfzdr/myblog-webä¸‹é¢æ–°å»ºä¸€ä¸ªuwsgi_confæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶ååœ¨uwsgi_confæ–‡ä»¶å¤¹ä¸‹æ–°å»ºuwsgi.iniæ–‡ä»¶</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[uwsgi]</span>
<span class="c">#ä½¿ç”¨HTTPè®¿é—®çš„ç«¯å£å·, ä½¿ç”¨è¿™ä¸ªç«¯å£å·æ˜¯ç›´æ¥è®¿é—®äº†uWSGI, ç»•è¿‡äº†Nginx
</span><span class="py">http</span> <span class="p">=</span> <span class="s">:8080</span>

<span class="c"># å¦‚æœä½ å·²ç»é…ç½®äº†nginx(å¯åŠ¨äº†nginxæœåŠ¡ï¼Œé…ç½®äº†uwsgi_pass)ï¼Œè¯·ç”¨è¿™ä¸ªsocketè¿æ¥
</span><span class="py">socket</span> <span class="p">=</span> <span class="s">0.0.0.0:8001</span>
<span class="c">#æ˜¯å¦ä½¿ç”¨ä¸»çº¿ç¨‹
</span><span class="py">master</span> <span class="p">=</span> <span class="s">true</span>

<span class="c"># é¡¹ç›®åœ¨æœåŠ¡å™¨ä¸­çš„ç›®å½•(ç»å¯¹è·¯å¾„)
</span><span class="py">chdir</span> <span class="p">=</span> <span class="s">/home/zfzdr/myblog-web</span>

<span class="py">module</span> <span class="p">=</span> <span class="s">myblog.wsgi</span>

<span class="c">;static-map=/static=%(chdir)/%(media)  # ä»…åŠ è½½mediaæ–‡ä»¶
;static-map=/static=%(chdir)/%(collect_static) # ä»…åŠ è½½staticæ–‡ä»¶
;for =collect_static media
;static-map=/static=%(chdir)/%(_)
;endfor =
# è®¾ç½®æ—¥å¿—ç›®å½•
</span><span class="py">daemonize</span><span class="p">=</span><span class="s">%(chdir)/uwsgi_conf/uwsgi.log</span>
<span class="c"># uWSGIè¿›ç¨‹å·å­˜æ”¾
</span><span class="py">pidfile</span><span class="p">=</span><span class="s">%(chdir)/uwsgi_conf/uwsgi.pid</span>

<span class="c"># Django's wsgi æ–‡ä»¶ç›®å½•
#wsgi-file = project_name/wsgi.py
# æŒ‡æ˜é€šè¿‡uwsgiå¯åŠ¨æœ€å¤§è¿›ç¨‹æ•°
</span><span class="py">processes</span> <span class="p">=</span> <span class="s">4</span>
<span class="c">#æ¯ä¸ªè¿›ç¨‹çš„çº¿ç¨‹æ•°
</span><span class="py">threads</span> <span class="p">=</span> <span class="s">2</span>
<span class="c">#çŠ¶æ€ç›‘å¬ç«¯å£
</span><span class="py">stats</span> <span class="p">=</span> <span class="s">127.0.0.1:9191</span>
<span class="c"># é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†ç¯å¢ƒé…ç½®
</span><span class="py">vacuum</span> <span class="p">=</span> <span class="s">true </span>
<span class="c">#ç›®å½•ä¸‹æ–‡ä»¶æ”¹åŠ¨æ—¶è‡ªåŠ¨é‡å¯
</span><span class="py">touch-reload</span> <span class="p">=</span> <span class="s">/home/zfzdr/Webå¼€å‘/myblog-web</span>
<span class="c">#Pythonæ–‡ä»¶æ”¹åŠ¨æ—¶è‡ªåŠ¨é‡å¯
</span><span class="py">py-auto-reload</span> <span class="p">=</span> <span class="s">1</span>
<span class="c">#åå°è¿è¡Œå¹¶æŠŠæ—¥å¿—å­˜åˆ°.logæ–‡ä»¶
;daemonize = /home/zfzdr/Webå¼€å‘/myblog/uWSGI.log
</span></code></pre></div></div>

<p>é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨uwsgi</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uwsgi <span class="nt">--ini</span> uwsgi_conf/uwsgi.ini
</code></pre></div></div>

<p>æ³¨æ„uwsgiä¸ä¼šå¤„ç†é™æ€æ–‡ä»¶ï¼Œå¦‚æœæœ‰ï¼Œä¹Ÿæ˜¯æµè§ˆå™¨çš„ç¼“å­˜ã€‚å¦‚æœæƒ³uwsgiä¹ŸåŠ è½½é™æ€æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡static-mapæŒ‡å®šé™æ€æ–‡ä»¶ä½ç½®</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">static-map</span><span class="p">=</span><span class="s">/static=%(chdir)/%(media)  # ä»…åŠ è½½mediaæ–‡ä»¶</span>
<span class="py">static-map</span><span class="p">=</span><span class="s">/static=%(chdir)/%(collect_static) # ä»…åŠ è½½staticæ–‡ä»¶</span>
</code></pre></div></div>

<ol>
  <li>.é…ç½®djangoçš„settings.pyï¼Œæ”¶é›†æ‰€æœ‰myblogé¡¹ç›®æ‰€éœ€çš„é™æ€æ–‡ä»¶</li>
</ol>

<p>åœ¨settings.pyé…ç½®æ–‡ä»¶åŠ ä¸‹é¢ä¸€è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>STATIC_ROOT = os.path.join(BASE_DIR, "collect_static")
</code></pre></div></div>

<p>æ‰§è¡Œå‘½ä»¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py collectstatic
</code></pre></div></div>

<h2 id="é…ç½®nginx">é…ç½®nginx</h2>

<p>é…ç½®ä¸€ä¸ªç½‘ç«™å…¥å£ï¼Œå½“ç”¨æˆ·è®¿é—®192.168.88.67:80 è¿™ä¸ªwebåº”ç”¨æ—¶ï¼Œè‡ªåŠ¨å°†è¯·æ±‚è½¬å‘ç»™uwsgiï¼Œuwsgiå¤„ç†åï¼Œè¿”å›ç»™nginxï¼Œè¿”å›ç»™ç”¨æˆ·</p>

<p>å½“è¯·æ±‚æ˜¯192.168.88.67:80çš„æ—¶å€™ï¼Œå…¶å®è®¿é—®çš„æ˜¯192.168.88.67:9999 è¿™æ˜¯åŠ¨æ€è¯·æ±‚ï¼Œå› ä¸ºæˆ‘æ˜¯æ‰¾åˆ°çš„uwsgi</p>

<p>nginx.confé…ç½®å¦‚ä¸‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>upstream blog_app {
   # nginxé€šè¿‡socketåœ¨ç¯å›æ¥å£åœ°å€çš„9001ç«¯å£ä¸æœ¬åœ°çš„uWSGIè¿›ç¨‹é€šä¿¡
   # æ”¯æŒip:portæ¨¡å¼ä»¥åŠsocket fileæ¨¡å¼
   #server unix:/opt/mywebapp/uwsgi_conf/uwsgi.sock;
   server 127.0.0.1:8001;
}


server {
    listen 8080;
    #server_name ;
    # æ¥å…¥æŠ¥å‘Šæ—¥å¿—
    access_log /home/zfzdr/myblog-web/nginx_conf/access.log;
    # é”™è¯¯æ—¥å¿—
    error_log /home/zfzdr/myblog-web/nginx_conf/error.log;
    charset utf-8;

    gzip_types text/plain application/x-javascript text/css text/javascript application/x-httpd-php application/json text/json image/jpeg image/gif image/png application/octet-stream;
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;

    location /{
        # nginxè½¬å‘åŠ¨æ€è¯·æ±‚åˆ°uWSGI
        include /home/zfzdr/myblog-web/uwsgi_conf/uwsgi_params;
        #uwsgi_connect_timeout 20;ã€€
        uwsgi_pass blog_app;
    }

    # å¦‚æœå†™æˆ/static/,nginxæ— æ³•æ‰¾åˆ°é¡¹ç›®é™æ€æ–‡ä»¶è·¯å¾„
    location /static {
        alias /home/zfzdr/myblog-web/collect_static/;
    }

    # å¦‚æœå†™æˆ/media/,nginxæ— æ³•æ‰¾åˆ°é¡¹ç›®åª’ä½“æ–‡ä»¶è·¯å¾„
    location /media {
        alias  /home/zfzdr/myblog-web/media/;
    }

}
</code></pre></div></div>

<ul>
  <li>
    <p>æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nginx <span class="nt">-t</span>
nginx <span class="nt">-s</span> reload
nginx
</code></pre></div>    </div>

    <p>å¦‚æœè®¿é—®æ—¶å‡ºç°çš„æ˜¯nginxå®˜æ–¹é¡µé¢ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯æ²¡æœ‰åŠ è½½åˆ°è‡ªå·±çš„é…ç½®ï¼Œå°†sites- ä¸‹çš„é…ç½®åˆ æ‰ï¼Œå°±èƒ½è®¿é—®åˆ°è‡ªå·±çš„ç½‘ç«™äº†</p>

    <h1 id="å®ç°å®¹å™¨å¼€æœºè‡ªå¯åŠ¨çš„æ–¹æ³•">å®ç°å®¹å™¨å¼€æœºè‡ªå¯åŠ¨çš„æ–¹æ³•</h1>

    <p>åœ¨rootä¸‹æ–°å»ºshellè„šæœ¬run.sh</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>
/etc/init.d/ssh start
/bin/bash
</code></pre></div>    </div>

    <p>æ·»åŠ æ‰§è¡Œæƒé™</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x run.sh
</code></pre></div>    </div>

    <p>ç”Ÿæˆé•œåƒï¼Œå¯åŠ¨æ—¶è¿è¡Œrun.sh</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-p</span> 22:22 <span class="nt">-p</span> 8000:8000 <span class="nt">-p</span> 8080:8080 zfzdr/django:1.5 /root/run.sh <span class="c"># åœ¨æ–°å®¹å™¨é‡Œé¢æ‰§è¡Œ/root/run.sh å‘½ä»¤ï¼Œå³æ‰§è¡Œä¸Šé¢çš„è„šæœ¬å‘½ä»¤</span>
</code></pre></div>    </div>
  </li>
</ul>

:ET