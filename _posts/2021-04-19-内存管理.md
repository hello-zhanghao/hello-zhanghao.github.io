---
layout: blog
category: 计算机
tags: 操作系统
---

# 内存管理

## 虚拟内存

虚拟内存的目的是为了让物理内存扩充成更大的逻辑内存，从而让程序获得更多的可用内存。

## 分页系统地址映射

一个虚拟地址分成两个部分，一部分存储页号，一部分存储偏移量。内存管理单元（MMU）借助页表完成虚拟内存地址到物理内存地址的转换（页表存储程序地址空间的页到物理地址空间的页框的映射）

## 页面置换算法

在程序运行过程中，如果要访问的页面不在内存中，就会发生缺页中断，操作系统将缺失的页调入内存中。如果姿势物理内存已满，则需要将内存中的页面调入到磁盘对换区来腾出操作空间，选择合适的页面调出使得页面的置换频率最低（缺页率最低），这就是页面置换的目的。

### 最佳页面置换算法（OPT）

选择最长时间不再被访问的页面进行置换，可以保证最低的缺页率。但是系统不可能知道哪个页面最长时间不再被访问（这是未来的事情），因此该算法不可被实现。但是可以运行一个程序两次来获得最优的页面置换算法，作为其他置换算法的一个上界。

### 最近最久未使用算法（LRU)

虽然无法知道将要使用的页面的情况，但是可以知道过去页面使用的情况，选择最近最久未使用的页面将其置换出去。

- 实现方法

  维护一个存储所有页面的链表，每次访问一个页面时就将该页面移到链表表头，则链表表位的页表是最近最久未访问的。

- 缺点

  需要维护一个链表，且每次访问都需要更新链表，时间复杂度和空间复杂度都很高

### 最近未使用（NRU)

每个页面都有两个状态位，R(读）位，当页面被访问时设置为1，M(修改）位，当页面被修改时设置为1。R位会定时被清零。因此页面的状态可以分为四种状态：

RW=00,01,10,11

每当需要置换页面时，就从类编号最小的非空类中随机选择一个页面置换。

NRU 优先换出已经被修改的脏页面（R=0，M=1），而不是被频繁使用的干净页面（R=1，M=0）。

### 先进先出（FIFO）

选择最先进入的页面

- 缺点

  该算法会将那些经常被访问的页面也被换出，从而使缺页率升高。

### 第二次机会法

FIFO算法容易把经常使用的页面置换，第二次机会法是针对FIFO算法的改进。

每个页面会有一个状态位R，当页面被访问（读写）时，该页面置为1。当需要置换页面时，首先检查最先进入的页面，如果R=0，则直接换出，如果R=1，则将该页面的R置为0,并将该页面放入链表尾部

### 时钟

第二次机会算法需要在链表中移动页面，降低效率。始终算法使用环形链表，使用一个指针指向最老的页面。其余类似第二次机会法。

## 分段

解决动态增长的问题，结合分段和分页的优点，有段页式。分页主要用于实现虚拟内存，从而获得更大的地址空间；分段主要是为了使程序和数据可以被划分为逻辑上独立的地址空间并且有助于共享和保护。

